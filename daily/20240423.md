# 202404 플러터 과정 9주차 화요일

## 1. 꼭 기억할 것! 🏅
### Stream
- 실시간으로 생성되고 전송되는 데이터의 흐름
- 데이터 수정 -> UI변경이 자동으로 (provider)
	ex. Stream builder (google map 할 때)
	ex. firebase (remote db)

### Stream Builder
- 이건 어려운 코드라 안 다룰 것
- 데이터가 없는 경우의 처리도 한 군데서 다 처리함
- 원하는 부분만 UI 갱신이 가능함
- 스트림 빌더 (Future bulder와 사용방법 유사함)
- initial builder가 있어서 초기값 설정 말고는 사용방법 똑같음
- 수평계 샘플 https://github.com/junsuk5/flutter-first-guide/blob/master/tilt_sensor/lib/main.dart

### 구독 / 해지
- Stream 데이터를 UI 로 변환할 필요가 없는 경우에 활용
- listen() 으로 구독

  ![image](https://github.com/itbebop/TIL/assets/86880025/cdb16090-2863-486b-b864-22573d15d3a2)

- cancel() 로 해지

  ![image](https://github.com/itbebop/TIL/assets/86880025/1b061388-03f0-4868-bc71-19875f6996f5)

- listen() 으로 시작한 구독을 해지하려면 StreamSubscription 객체의 인스턴스를 통해야 한다

![image](https://github.com/itbebop/TIL/assets/86880025/fc460e82-a5b5-4c6b-ba23-675a978aa16b)

- 구독의 해지

- StreamController 작성

하나의 리스터를 허용하는 스트림
- 구독을 한 군데서 밖에 못함
- Cold Stream이라고 함 (다른 언어에서도 동일함)
- 내가 요청하면 데이터를 줌
- 주로 이 스트림 유형을 사용함

```dart
final _streamController = StreamContorller<int>();

_streamContorller.add(10);
// 사실은 add라기보다 안에 있거나 아예 값이 없거나 
```

여러 리스너를 허용하는 브로드캐스트 스트림(Hot Stream)
- 요청과 상관없이 데이터를 줌
- 이전 화면의(지나간) 에러는 표시를 안해도 되는 경우
```dart
final _streamController = StreamController<int>.braodcase();
```

![image](https://github.com/itbebop/TIL/assets/86880025/4681d6b5-36d6-480f-ba32-e79f2820ee3c)

### Stream sample 만들기

[http://worldtimeapi.org/api/timezone/Asia/Seoul](http://worldtimeapi.org/api/timezone/Asia/Seoul "http://worldtimeapi.org/api/timezone/Asia/Seoul")
- 이 api를 이용하여 stream을 만들어 볼  것
- global app을 만들 때의 시간은 utc 기준으로 해야함


- model

![image](https://github.com/itbebop/TIL/assets/86880025/394d6f4b-afc4-4f98-b739-804d80afdd50)

![image](https://github.com/itbebop/TIL/assets/86880025/6bf51f1d-d2d2-47ed-bbfd-5f953dbe957e)

- 변수 생성하자마자 값 넣음
- async 못넣어서 then을 써서 값을 넣음

![image](https://github.com/itbebop/TIL/assets/86880025/1e847300-97e8-4812-b82f-3ebcc8060746)

- 5초에 한번씩 반복

![image](https://github.com/itbebop/TIL/assets/86880025/f18906bb-6c4a-4527-a20a-683e857b3bcd)

- getter로 stream 내보내고

![image](https://github.com/itbebop/TIL/assets/86880025/fd0f0e2b-1f69-40b0-8923-e31d0b2c121f)

- stream에 들어가있는 데이터를 내보낼 때는 controller에 .stream객체를 통해서 내보냄

### test

![image](https://github.com/itbebop/TIL/assets/86880025/d3c2963e-e97a-4036-8abe-fb63231a855a)

- test package

- repository는 아직 없어서 가짜 객체 만듬

![image](https://github.com/itbebop/TIL/assets/86880025/ebb4d546-60a6-4b63-8be2-9c973805f78e)

- _times ++ 하면 다음 객체 전달해줌

![image](https://github.com/itbebop/TIL/assets/86880025/5c7fedcc-2bcd-4126-834f-9ff9a65be257)


### usecase

![image](https://github.com/itbebop/TIL/assets/86880025/df9ab9bf-1947-4fe1-ac18-9d7b6fd1f232)


- execute()에서 스트림을 내보내는 것으로 수정

![alt text](image-203.png)

- Timerperiodic실행하고, 리턴해서 그걸 가져다가 쓰면 됨

### 다시 테스트

![image](https://github.com/itbebop/TIL/assets/86880025/fdf3ff11-0229-419d-a6e9-83a9a4ad882a)

### 디버깅

![image](https://github.com/itbebop/TIL/assets/86880025/e7b1099c-07db-4d70-9705-406a3cbe6cc0)

- 함수를 추가함

![image](https://github.com/itbebop/TIL/assets/86880025/11010923-70fb-4459-b68f-c5735371eabd)

ㅁ 정리
- controller만들고
- .add 한 것
- stream return 하는 것
- stream을 getter로 내보낸다.

### main viewmodel

ㄴtime은 계속 바뀌는 데이터
ㄴprovider를 쓰는 건 Futurebuilder를 안써도 되서

- usecase를 받음
- 생성자에서 바로 start를 해버림

![image](https://github.com/itbebop/TIL/assets/86880025/5154bbce-a155-42d0-bcfc-387b8460071e)

![image](https://github.com/itbebop/TIL/assets/86880025/eb20de24-99d7-428d-9c5f-27f898720719)

### view

![image](https://github.com/itbebop/TIL/assets/86880025/fb0496ef-da94-48dc-9665-3dd1bf26a37d)


### DI

![image](https://github.com/itbebop/TIL/assets/86880025/29b10b9b-1810-46aa-8ba8-296cd6e8850f)


- GetIn의 인스턴스 가져와서 di Setup
- repositoryImpl을 승격 시킴

![image](https://github.com/itbebop/TIL/assets/86880025/e2025305-f4eb-4d1b-90b0-fd5f7cc3945e)


## 2. 한줄 정리 🧹
1. Stream 공식문서 영상 볼 것 https://youtu.be/nQBpOIHE4eE
2. 의존성은 이미 주입하고 있었음
3. 즉, 의존성 주입하려고 get it을 쓰는 게 아니다.
4. get it을 썼을 때의 장점은 service locator 패턴으로 의존성 주입을 해주는 것
5. go router 안 쓰고 get it만 쓰면 더 엉망진창이 될 수 있음
6. main함수를 깔끔하게 쓰려고 하는 것이 목적임

## 3. 참고
1. 함수들을 모아둔 사이트 https://reactivex.io/
2. RXdart 
	- bloc 쓸 땐 써야
	- 아래 함수들 지원함
	  - ex. Map
	  - ex. Filter (dart에서는 where)
    - ex. Debounce (dart에서는 제공 x)
	  - ex. take
